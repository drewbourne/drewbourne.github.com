<!DOCTYPE html>
<html id="drew.firstbourne.com">
  <head>
    <title>Plucking Chickens</title>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="/css/screen.css" charset="utf-8" />
  </head>
  <body>
    <section>
      <header>
        <a href="/">Drew Bourne</a>
      </header>
      
      
<article>
  <header>
    <h1>Plucking Chickens</h1>
  </header>
  <p>I have some chickens, and I want to know how many feathers they have each.</p>
<pre><code>
var chickens:Array = [new Chicken({ feathers: Math.round(Math.random() * 5000) }), 
                      new Chicken({ feathers: Math.round(Math.random() * 5000) }),
                      new Chicken({ feathers: Math.round(Math.random() * 5000) })];
var feathersPerChicken:Array = null;
</code></pre>
<p>I would rather not sit there and iterate through my chickens, picking up each one, counting its feathers and then letting it run off, remembering where I got up to, and then possible forgetting which chicken I was up to.</p>
<pre><code>
for (var i:int = 0, n:int = chickens.length; i &lt; n; i++) {
  var chicken:Chicken = chickens[i];
  var feathers:Number = chicken.feathers;
  feathersPerChicken.push(feathers);
}
</code></pre>
<p>Eww, I almost stepped on a temporary variable one of the chickens left behind.</p>
<p>Good thing we know how to clean that up with a <code>map</code>.</p>
<pre><code>
var feathersPerChicken:Array = chicken.map(function(chicken:Chicken, i:int, a:Array):void {
  return chicken.feathers;
});
</code></pre>
<p>I just remembered I need to know the weights of all the chickens too. We should probably get out our <code>map</code> again.</p>
<pre><code>
var weightsPerChicken:Array = chicken.map(function(chicken:Chicken, i:int, a:Array):void {
  return chicken.weight;
});
</code></pre>
<p>It is looking pretty similar to last time. Could we do something to remove the repetition and show only what changes? Lets give this a few go&#8217;s.</p>
<pre><code>
function getChickenProperty(property:String):Function {
  return function(chicken:Chicken, i:int, a:Array):Object {
    return chickenProperty[property];
  }
}
var feathersPerChicken:Array = chickens.map(getChickenProperty("feathers"));
var weightsPerChicken:Array = chickens.map(getChickenProperty("weight"));
</code></pre>
<p>Reasonable attempt, but we might not always be dealing with chickens, feathers and weights. Lets go again.</p>
<pre><code>
function getProperty(property:String):Function {
  return function(item:Object, i:int, a:Array):Object {
    return item[property];
  }
}
var feathersPerChicken:Array = chickens.map(getProperty("feathers"));
var weightsPerChicken:Array = chickens.map(getProperty("weight"));
</code></pre>
<p>Thats more like it. However why do we have to get out the <code>map</code> and <code>getProperty</code> when what we want is to <em>pluck some feathers</em>.</p>
<p>If we shuffle the code around a little we can forget about <code>map</code>, <code>getProperty</code>, temporary variables, and iterator functions and say what we really mean.</p>
<pre><code>
function pluck(array:Array, property:String):Array {
  return array.map(function(item:Object, i:int, a:Array):Object {
    return item[property];
  });
}
  
var feathersPerChicken:Array = pluck(chickens, "feathers");
var weightsPerChicken:Array = pluck(chickens, "weight");
</code></pre>
<p>As an exercise what if the <code>Chicken.feathers</code> property was an <code>Array</code> instead of a <code>Number</code>, how could we change <code>pluck()</code> to support the following?</p>
<pre><code>
var feathersPerChicken:Array = pluck(chicken, "feathers.length");
</code></pre>
<p><code>pluck()</code> is available in <a href="http://github.com/drewbourne/asx/tree/master">asx</a> and supports chained look-ups <code>"propertyA.propertyB.length"</code> and simple methods <code>"property.toLowerCase()"</code>.</p>
</article>

<section id="related-posts">
  <header>
    <h2>Related Posts</h2>
  </header>
  <ul>
    
  </ul>
</section>
      
    </section>
    <footer>
      <section class="posts">
        <header><h2>Posts</h2></header>
        <ul>
          
          <li>
            <span>12 Feb 2009</span> 
            <a href="/2009/02/12/o-hai.html">O HAI</a>
          </li>
          
          <li>
            <span>12 Feb 2009</span> 
            <a href="/2009/02/12/plucking-chickens.html">Plucking Chickens</a>
          </li>
          
        </ul>
      </section>
      <section id="projects">
        <header><h2>Projects</h2></header>
        <ul>
          <li><a href="http://code.google.com/p/mock-as3/">mock-as3 <span class="desc">Mock Objects for AS3</span></a></li>
          <li><a href="http://github.com/drewbourne/hamcrest-as3/tree/master">hamcrest-as3 <span class="desc">Hamcrest Matchers for ActionScript 3</span></a></li>
          <li><a href="http://github.com/drewbourne/asx/tree/master">asx <span class="desc">Extensions for ActionScript 3 Core Objects</span></a></li>
          
          <li><a href="http://github.com/drewbourne/spectacular/tree/master">Spectacular <span class="desc">TDD/BDD the way I want</span></a></li>
          
          
        </ul>
      </section>
      <section id="contact">
        <header><h2>Contact</h2></header>
        <ul>
          <li><a href="mailto:drew@firstbourne.com">drew@firstbourne.com</a></li>
          <li><a href="http://twitter.com/drewbourne">twitter.com/drewbourne</a></li>
          <li><a href="http://github.com/drewbourne">github.com/drewbourne</a></li>
          
        </ul>
      </section>
    </footer>
  </body>
</html>